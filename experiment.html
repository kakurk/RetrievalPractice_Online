<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
        <script src="jspsych-6.3.0/jspsych.js"></script>
        <script src="jspsych-6.3.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.3.0/plugins/jspsych-canvas-keyboard-response.js"></script>
        <script src="jspsych-6.3.0/plugins/jspsych-canvas-keyboard-response-mouse-click.js"></script>
        <script src="jspsych-6.3.0/plugins/jspsych-preload.js"></script>
        <script src="encoding.js"></script>
        <script src="restudy.js"></script>
        <script src="retpractice.js"></script>
        <link href="jspsych-6.3.0/css/jspsych.css" rel="stylesheet" type="text/css">
        <style>
            .parent {
              position: relative;
              width: 300px;
              height: 300px;
              background-image: url(https://placehold.it/300);
              border: 5px blue solid;
            }
            .foreground {
              position: absolute;
              top: 30px;
              left: 30px;
              border: 5px red solid;
            }
          </style>
    </head>
    <body></body>
    <script>

    // experiment wide parameters
    var canvasW = 1200 // width of the drawing area (px)
    var canvasH = 600 // height of the drawing area (px)
    var objectH = 150 // height of the object (px)
    var objectW = 150 // width of the object (px)
    var sceneW = 1000 // width of the scene (px)
    var sceneH = sceneW*(412/600) // height of the scene (px)
    var guide_cir_r = 250; // radius of guide circle, (px)
    var innerR = guide_cir_r - 25; // inner click area radius, (px)
    var outerR = guide_cir_r + 25; // outer click area radius, (px)

    // experiment wide

    var iti = {
        type: 'html-keyboard-response',
        stimulus: '<p style="font-size: 48px;">+</p>',
        choices: jsPsych.NO_KEYS,
        trial_duration: 1000};

    // preload stimuli
    var scenes_to_preload
    var objects_to_preload
    scenes_to_preload = enc_data.map(enc_data => enc_data.Scene);
    objects_to_preload = enc_data.map(enc_data => enc_data.Object);
    var preload = {
     type: 'preload',
     images: scenes_to_preload.concat(objects_to_preload)
    }

    // encoding

    var enc_instruction = {
      type: 'html-keyboard-response',
      stimulus: '<p style="font-size: 48px;">How Likely is the object to be found in the scene?</p><p>1- Likely 2 - Unlikely</p>',
      choices: jsPsych.NO_KEYS,
      trial_duration: 4000,
    };

    var encoding_stimulus = {
     type: 'canvas-keyboard-response',
     stimulus: function(c) {
       // c.style.border = "5px solid #A9A9A9";
       // present images on a canvas at specific locations
       var ctx = c.getContext('2d');
       var object = new Image();
       var scene = new Image();
       object.src = jsPsych.timelineVariable('Object');
       scene.src = jsPsych.timelineVariable('Scene');
       var centerx = canvasW/2 - sceneW/2;
       var centery = canvasH/2 - sceneH/2;
       ctx.drawImage(scene, centerx, centery, sceneW, sceneH);
       var centerx = canvasW/2 - objectW/2;
       var centery = canvasH/2 - objectH/2;
       var xPos = jsPsych.timelineVariable('xPos');
       var yPos = jsPsych.timelineVariable('yPos');
       ctx.drawImage(object, centerx+xPos, centery+yPos, objectW, objectH);
       // ctx.drawImage(object, centerx, centery-200, objectW, objectH);
     },
     canvas_size: [canvasH, canvasW],
     choices: ['1','2'],
     trial_duration: 4000
    };

    var encoding_trials = {
      timeline: [iti, encoding_stimulus],
      timeline_variables: enc_data
    }

    var encoding = {timeline: [enc_instruction, encoding_trials, iti]}

   // Restudy

   var restudy_instructions = {
     type: 'html-keyboard-response',
     stimulus: '<p style="font-size: 48px;">RESTUDY</p>',
     choices: jsPsych.NO_KEYS,
     trial_duration: 4000,
   }

   var restudy_stimulus = encoding_stimulus
   restudy_stimulus.trial_duration = 6000

   var restudy_trials = {
     timeline: [iti, restudy_stimulus],
     timeline_variables: restudy_data,
   }

   var restudy = {timeline: [restudy_instructions, restudy_trials]}

   // Practice

   var retpractice_instructions = {
     type: 'html-keyboard-response',
     stimulus: '<p style="font-size: 48px;">PRACTICE</p>',
     choices: jsPsych.NO_KEYS,
     trial_duration: 4000,
   }

   var recontruct_trial = {
     type: 'canvas-keyboard-response-mouse-click',
     images: [jsPsych.timelineVariable('Object'), jsPsych.timelineVariable('Scene')],
     stimulus: function(c, object, scene) {
       // canvas
       var ctx = c.getContext('2d');
       // draw scene
       var centerx = canvasW/2 - sceneW/2;
       var centery = canvasH/2 - sceneH/2;
       ctx.drawImage(scene, centerx, centery, sceneW, sceneH);
       // draw object
       var centerx = canvasW/2 - objectW/2;
       var centery = canvasH/2 - objectH/2;
       ctx.drawImage(object, centerx, centery, objectW, objectH);
       // draw guide circle
       ctx.strokeStyle = 'black'
       ctx.setLineDash([15, 15]);
       ctx.arc(canvasW/2, canvasH/2, guide_cir_r, 0, 2 * Math.PI);
       ctx.lineWidth = 5;
       ctx.stroke();
     },
     canvas_size: [canvasH, canvasW],
     click_area: [innerR, outerR],
     choices: ['1','2','3','4','5','6'],
     trial_duration: 6000
   };

   var feedback = encoding_stimulus;
   feedback.trial_duration = 1000;
   feedback.stimulus = function(c){
     // present images on a canvas at specific locations
     var ctx = c.getContext('2d');
     // draw scene
     var scene = new Image();
     scene.src = jsPsych.timelineVariable('Scene');
     var centerx = canvasW/2 - sceneW/2;
     var centery = canvasH/2 - sceneH/2;
     ctx.drawImage(scene, centerx, centery, sceneW, sceneH);
     // draw guide circle
     ctx.strokeStyle = 'black'
     ctx.setLineDash([15, 15]);
     ctx.arc(canvasW/2, canvasH/2, guide_cir_r, 0, 2 * Math.PI);
     ctx.lineWidth = 5;
     ctx.stroke();
     // draw object jsPsych.timelineVariable('obj_width')*.75, jsPsych.timelineVariable('obj_width')*jsPsych.timelineVariable('obj_ratio')*.75
     var object = new Image(50,50);
     object.src = jsPsych.timelineVariable('Object');
     var centerx = canvasW/2 - objectW/2;
     var centery = canvasH/2 - objectH/2;
     var xPos = jsPsych.timelineVariable('xPos');
     var yPos = jsPsych.timelineVariable('yPos');
     ctx.drawImage(object, centerx+xPos, centery+yPos, objectW, objectH);
   }

   var practice_trials = {
     timeline: [iti, recontruct_trial, feedback],
     timeline_variables: enc_data
   }

   var practice = {timeline: [retpractice_instructions, practice_trials]}

   var restudy_practice = {timeline: [restudy, practice], repetitions: 3}

   // retrieval

   var retreival_instructions = {
     type: 'html-keyboard-response',
     stimulus: '<p style = "font-size: 48px;">RETREIVAL</p>',
     choices: jsPsych.NO_KEYS,
     trial_duration: 4000,
   }

   var retrieval_gist_test = {
     type: 'html-keyboard-response',
     stimulus: '',

   }

   var retreival_verbaitum_test = {

   }

   // initialize jsPsych

    jsPsych.init({
        timeline: [preload, practice] // restudy_practice
    })

    </script>

<!-- <div class='parent'>
  <img class="foreground" src="https://placehold.it/50" />
</div> -->

</html>
